(()=>{"use strict";function t(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&n(e)}}function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",t)}function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t)}var o={baseUrl:"https://nomoreparties.co/v1/pwff-cohort-1",headers:{authorization:"ae2e6766-97db-4f08-b0fd-1ef973641b71","Content-Type":"application/json"}},r=document.querySelector("#card-template").content;function c(t,o,c,a,u){var i=r.querySelector(".card").cloneNode(!0),s=i.querySelector(".card__image"),l=i.querySelector(".card__title"),p=i.querySelector(".card__delete-button"),d=i.querySelector(".card__like-button"),_=i.querySelector(".card__like-counter"),f=document.querySelector(".popup_type_confirm-delete"),h=f.querySelector(".popup__button"),m=t.likes;return s.src=t.link,s.alt=t.name,l.textContent=t.name,_.textContent=t.likes.length,t.owner._id!==o&&p.classList.add("card__delete-button_inactive"),m.forEach((function(t){t._id===o&&d.classList.add("card__like-button_is-active")})),p.addEventListener("click",(function(){e(f),h.onclick=function(){c(i,t._id),n(f)}})),d.addEventListener("click",(function(){a(d,_,t._id)})),s.addEventListener("click",u),i}function a(t,e){(function(t,e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:{authorization:t.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))})(o,e).then((function(){t.remove()})).catch((function(t){console.error(t)}))}function u(t,e,n){t.classList.contains("card__like-button_is-active")?function(t,e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:t.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(o,n).then((function(n){e.textContent=n.likes.length,t.classList.remove("card__like-button_is-active")})).catch((function(t){console.error(t)})):function(t,e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:t.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(o,n).then((function(n){e.textContent=n.likes.length,t.classList.add("card__like-button_is-active")})).catch((function(t){console.error(t)}))}function i(t,e,n){var o=e.querySelector(".".concat(n.id,"-error"));n.classList.remove(t.inputErrorClass),o.classList.remove(t.errorClass),o.textContent=""}function s(t,e){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){return i(t,e,n)})),o.classList.add(t.inactiveButtonClass)}function l(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?n.classList.remove(t.inactiveButtonClass):n.classList.add(t.inactiveButtonClass)}var p,d=null,_={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},f=document.querySelector(".places__list"),h=document.querySelector(".profile__add-button"),m=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__edit-image"),v=document.querySelectorAll(".popup"),b=document.querySelector(".popup_type_edit"),S=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_image"),C=document.querySelector(".popup_change-avatar"),L=b.querySelector(".popup__form"),k=L.querySelector(".popup__input_type_name"),E=L.querySelector(".popup__input_type_description"),g=L.querySelector(".popup__button"),x=S.querySelector(".popup__form"),z=x.querySelector(".popup__input_type_card-name"),j=x.querySelector(".popup__input_type_url"),P=x.querySelector(".popup__button"),T=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),U=document.querySelector(".profile__image"),B=q.querySelector(".popup__image"),w=q.querySelector(".popup__caption"),D=C.querySelector(".popup__form"),N=D.querySelector(".popup__input_type_url"),O=D.querySelector(".popup__button");function J(t){return function(){!function(t){B.src=t.link,B.alt=t.name,w.textContent=t.name}(t),e(q)}}m.addEventListener("click",(function(){k.value=T.textContent,E.value=A.textContent,s(_,L),e(b)})),h.addEventListener("click",(function(){e(S)})),y.addEventListener("click",(function(){e(C)})),v.forEach((function(t){t.addEventListener("click",(function(e){e.target.classList.contains("popup")&&n(t),e.target.classList.contains("popup__close")&&n(t)}))})),L.addEventListener("submit",(function(t){t.preventDefault(),g.textContent="Сохранение...",g.classList.add("popup__button_disabled"),function(t,e,n){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:{authorization:t.headers.authorization,"Content-Type":t.headers["Content-Type"]},body:JSON.stringify({name:e,about:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(o,k.value,E.value).then((function(t){T.textContent=t.name,A.textContent=t.about,n(b)})).catch((function(t){g.classList.remove("popup__button_disabled"),console.error(t)})).finally((function(){g.textContent="Сохранить"}))})),x.addEventListener("submit",(function(t){t.preventDefault(),P.textContent="Сохранение...",P.classList.add("popup__button_disabled"),function(t,e,n){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:{authorization:t.headers.authorization,"Content-Type":t.headers["Content-Type"]},body:JSON.stringify({name:e,link:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(o,z.value,j.value).then((function(t){var e=J(t),o=c(t,d,a,u,e);n(S),x.reset(),s(_,x),f.prepend(o)})).catch((function(t){P.classList.remove("popup__button_disabled"),console.error(t)})).finally((function(){P.textContent="Сохранить"}))})),D.addEventListener("submit",(function(t){t.preventDefault(),O.textContent="Сохранение...",O.classList.add("popup__button_disabled"),function(t,e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t.headers.authorization,"Content-Type":t.headers["Content-Type"]},body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(o,N.value).then((function(t){U.style.backgroundImage="url(".concat(t.avatar,")"),n(C),D.reset(),s(_,D)})).catch((function(t){O.classList.remove("popup__button_disabled"),console.error(t)})).finally((function(){O.textContent="Сохранить"}))})),p=_,Array.from(document.querySelectorAll(p.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);l(t,n,o),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){!function(t){if("url"!==t.type&&""!==t.value){var e=t.getAttribute("data-error-message");/^[a-zA-Zа-яА-ЯёЁ\s\-]+$/.test(t.value)?t.setCustomValidity(""):t.setCustomValidity(e)}}(n),n.validity.valid?i(t,e,n):function(t,e,n,o){var r=e.querySelector(".".concat(n.id,"-error"));n.classList.add(t.inputErrorClass),r.textContent=o,r.classList.add(t.errorClass)}(t,e,n,n.validationMessage)}(t,e,r),l(t,n,o)}))}))}(p,t)})),Promise.all([function(t){return fetch("".concat(t.baseUrl,"/users/me"),{headers:{authorization:t.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(o),function(t){return fetch("".concat(t.baseUrl,"/cards"),{headers:{authorization:t.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(o)]).then((function(t){var e,n=t[0],o=t[1];d=n._id,e=n,T.textContent=e.name,A.textContent=e.about,U.style.backgroundImage="url(".concat(e.avatar,")"),o.forEach((function(t){var e=J(t),n=c(t,d,a,u,e);f.append(n)}))})).catch((function(t){console.error(t)}))})();